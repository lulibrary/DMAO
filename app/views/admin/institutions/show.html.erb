<% content_for :title, 'Institution Profile' %>

<div class="row">
  <div class="col-md-3">

    <!-- Profile Image -->
    <div class="box box-primary">
      <div class="box-body box-profile">
        <img class="profile-user-img img-responsive img-circle" src="../../dist/img/user4-128x128.jpg" alt="User profile picture">

        <h3 class="profile-username text-center"><%= @institution.name %></h3>

        <p class="text-muted text-center"><%= link_to @institution.url %></p>

        <ul class="list-group list-group-unbordered">
          <li class="list-group-item">
            <b>Institution Admins</b> <a class="pull-right"><%= @institution.admins.count %></a>
          </li>
          <li class="list-group-item">
            <b>Institution Users</b> <a class="pull-right"><%= @institution.users.count %></a>
          </li>
        </ul>

        <!--<a href="#" class="btn btn-primary btn-block"><b>Follow</b></a>-->
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->

    <!-- Contact Details -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Contact Details</h3>
      </div>
      <!-- /.box-header -->
      <div class="box-body">
        <strong><i class="fa fa-user margin-r-5"></i> Name</strong>

        <p class="text-muted">
          <%= @institution.contact_name %>
        </p>

        <strong><i class="fa fa-envelope margin-r-5"></i> Email</strong>

        <p class="text-muted"><%= @institution.contact_email %></p>

        <% if @institution.contact_phone_number.present? %>

          <strong><i class="fa fa-phone margin-r-5"></i> Phone Number</strong>

          <p>
            <%= @institution.contact_phone_number %>
          </p>

        <% end %>

      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->

    <!-- Institution Details -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Details</h3>
      </div>
      <!-- /.box-header -->
      <div class="box-body">
        <strong><i class="fa fa-university margin-r-5"></i> Identifier</strong>

        <p class="text-muted">
          <%= @institution.identifier %>
        </p>

        <hr>

        <strong><i class="fa fa-external-link margin-r-5"></i> URL</strong>

        <p class="text-muted"><%= link_to @institution.url %></p>

        <% if @institution.description.present? %>

          <hr>

          <strong>Description</strong>

          <p><%= @institution.description %></p>

        <% end %>

      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->
  </div>
  <!-- /.col -->
  <div class="col-md-9">
    <div class="nav-tabs-custom">
      <ul class="nav nav-tabs">
        <li class="active"><a href="#admin-users" data-toggle="tab"><i class="fa fa-users margin-r-5"></i> Admin Users</a></li>
        <li><a href="#configuration" data-toggle="tab"><i class="fa fa-cogs margin-r-5"></i> Configuration</a></li>
        <li><a href="#ingest-jobs" data-toggle="tab"><i class="fa fa-cloud-download margin-r-5"></i> Ingests</a></li>
        <li><a href="#settings" data-toggle="tab"><i class="fa fa-cog margin-r-5"></i> Settings</a></li>
      </ul>
      <div class="tab-content">
        <div class="active tab-pane" id="admin-users">
          <!-- Post -->
          <div class="row">
            <%= render 'admin/institutions/admins/table' %>
          </div>
          <!-- /.post -->
        </div>
        <!-- /.tab-pane -->

        <div class="tab-pane" id="configuration">

          <div class="row">
            <div class="col-sm-12">
              <% if @institution.configuration %>

                <div class="box-group" id="accordion">
                  <!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
                  <div class="panel box box-primary">
                    <div class="box-header with-border">
                      <h4 class="box-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#crisSystem">
                          Cris System Configuration
                        </a>
                      </h4>
                    </div>
                    <div id="crisSystem" class="panel-collapse collapse in">
                      <div class="box-body">
                        <dl class="dl-horizontal">
                          <dt>CRIS System</dt>
                          <dd><%= @institution.configuration.systems_configuration.cris_system.details.name %></dd>
                          <dd><%= @institution.configuration.systems_configuration.cris_system.details.description %></dd>
                          <dd>Version: <%= @institution.configuration.systems_configuration.cris_system.details.version %></dd>
                          <br>
                          <% @institution.configuration.systems_configuration.cris_system.configuration_values.each do |v| %>
                            <dd><%= v.configuration_key.display_name %>: <%= v.configuration_key.secure ? "SECURE CONFIG VALUE" : v.value %></dd>
                          <% end %>
                          <br>
                          <dt>Organisation Ingester</dt>
                          <dd><%= @institution.configuration.systems_configuration.cris_system.details.organisation_ingester %></dd>
                          <dt>File based?</dt>
                          <dd><%= DMAO::Ingesters::FILE_INGESTERS.include? @institution.configuration.systems_configuration.cris_system.details.organisation_ingester.to_sym %></dd>
                        </dl>
                      </div>
                    </div>
                  </div>
                </div>

              <% else %>

                  <%= link_to "New Configuration", new_admin_institution_configuration_path(institution_id: @institution), class: "btn btn-block btn-primary" %>

              <% end %>

            </div>
          </div>

        </div>

        <div class="tab-pane" id="ingest-jobs">

          <div class="row">
            <div class="col-sm-12">

              <div class="box table-responsive">
                <div class="box-body no-padding">
                  <table class="table table-striped table-hover table-align-center">
                    <thead>
                    <tr>
                      <th>ID</th>
                      <th>Ingest Time</th>
                      <th>Ingest Status</th>
                      <th>Type</th>
                      <th>Mode</th>
                      <th>Area</th>
                      <th>Log File</th>
                      <th>Data File</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% @institution.ingest_jobs.each do |job| %>
                        <tr>
                          <th scope="row"><%= job.id %></th>
                          <td><%= job.ingest_time %></td>
                          <td><%= job.status %></td>
                          <td><%= job.ingest_type %></td>
                          <td><%= job.ingest_mode %></td>
                          <td><%= job.ingest_area %></td>
                          <td><%= job.ingest_log_file %></td>
                          <td><%= job.ingest_data_file %></td>
                        </tr>
                    <% end %>
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </div>

        </div>

        <div class="tab-pane" id="settings">

          <div class="row">

            <div class="col-sm-12">

                <%= form_for [:admin, @institution], html: { class: "form-horizontal" } do |f| %>

                    <% if @institution.errors.any? %>
                        <div id="error_explanation">
                          <h2>
                            <%= pluralize(@institution.errors.count, "error") %> prohibited
                            this institution from being saved:
                          </h2>
                          <ul>
                            <% @institution.errors.full_messages.each do |msg| %>
                                <li><%= msg %></li>
                            <% end %>
                          </ul>
                        </div>
                    <% end %>

                    <div class="form-group">

                      <%= f.label :name, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_field :name, class: "form-control" %>
                      </div>

                    </div>

                    <div class="form-group">

                      <%= f.label :identifier, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_field :identifier, class: "form-control" %>
                      </div>

                    </div>

                    <div class="form-group">

                      <%= f.label :description, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_area :description, class: "form-control" %>
                      </div>

                    </div>

                    <div class="form-group">

                      <%= f.label :contact_name, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_field :contact_name, class: "form-control" %>
                      </div>

                    </div>

                    <div class="form-group">

                      <%= f.label :contact_email, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_field :contact_email, class: "form-control" %>
                      </div>

                    </div>

                    <div class="form-group">

                      <%= f.label :contact_phone_number, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_field :contact_phone_number, class: "form-control" %>
                      </div>

                    </div>

                    <div class="form-group">

                      <%= f.label :url, class: "col-sm-2 control-label" %>

                      <div class="col-sm-10">
                        <%= f.text_field :url, class: "form-control" %>
                      </div>

                    </div>

                    <p>
                      <%= f.submit class: "btn btn-primary pull-right" %>
                    </p>

                <% end %>

            </div>

          </div>

        </div>
        <!-- /.tab-pane -->
      </div>
      <!-- /.tab-content -->
    </div>
    <!-- /.nav-tabs-custom -->
  </div>
  <!-- /.col -->
</div>